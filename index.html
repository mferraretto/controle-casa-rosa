<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controle de Pedidos Casa Rosa</title>
  <!-- Fonte moderna Inter -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet">

<!-- Font Awesome (Ã­cones bonitos) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Select2 (para filtros mÃºltiplos elegantes) -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

 <!-- Firebase App (core) + Firestore (modular v9+) -->
<!-- Firebase App (core) + Firestore (modular v9+) -->









<!-- Fonte moderna Inter -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet">

 


<!-- certifique-se de que pdf.js jÃ¡ estÃ¡ carregado -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.13.216/pdf.min.js"></script>

  <link rel="manifest" href="manifest.json">
  
  
</head>
<body>
  <h2 style="text-align:center; font-size:1.8rem; color:#dc3545; margin:1rem 0;">
    ğŸ“Š Controle Pedidos Casa Rosa
  </h2>

  <!-- teu layout de cards acima das abas permanece igual -->
<div style="text-align:right; margin:1rem;">
  <button onclick="alternarTema()" style="padding:0.5rem 1rem;" id="btnTema">ğŸŒ™ Modo Escuro</button>
</div>
<button onclick="deslogarUsuario()">ğŸšª Sair</button>

  <div class="tabs">
    <div class="tab" onclick="abrirAba('dashboard')"><i class="fas fa-chart-bar"></i> Dashboard</div>
<div class="tab active" onclick="abrirAba('importados')"><i class="fas fa-file-import"></i> Importados</div>
<div class="tab" onclick="abrirAba('enviados')"><i class="fas fa-truck"></i> Enviados</div>
<div class="tab" onclick="abrirAba('a_enviar')"><i class="fas fa-clock"></i> A Enviar</div>
<div class="tab" onclick="abrirAba('cancelados')"><i class="fas fa-ban"></i> Cancelados</div>
<div class="tab" onclick="abrirAba('etiquetas_pdf')"><i class="fas fa-file-pdf"></i> Etiquetas</div>
<div class="tab" onclick="abrirAba('aba-metas'); preencherLojasInputMeta(); preencherFiltroLojaMetas(); atualizarRelatorioMetas(); renderizarMetasManuais();">
  <i class="fas fa-bullseye"></i> Metas DiÃ¡rias
</div>
<div class="tab" onclick="abrirAba('aba-skus-equivalentes'); carregarSkusEquivalentes();">
  <i class="fas fa-code-branch"></i> SKUs Equivalentes
</div>
    <div class="tab" onclick="abrirAba('aba-produtos'); carregarProdutos();">
  <i class="fas fa-box"></i> Produtos
</div>
<div class="tab" onclick="abrirAba('aba-logs'); carregarLogs();">
  <i class="fas fa-clipboard-list"></i> Logs
</div>
<div class="tab" onclick="abrirAba('aba-admin'); preencherFiltroLojaMetas(); atualizarRelatorioMetas(); carregarProdutos(); atualizarCardsMetas();">
  <i class="fas fa-user-shield"></i> Administrador
</div>


  </div>
<div id="login" style="display:flex; flex-direction:column; gap:1rem; max-width:400px; margin:5rem auto;">
  <h2>ğŸ” Login</h2>
  <input type="email" id="emailLogin" placeholder="Email" style="padding:0.5rem;" />
  <input type="password" id="senhaLogin" placeholder="Senha" style="padding:0.5rem;" />
  <button onclick="fazerLogin()" style="padding:0.5rem;">Entrar</button>
  <div id="erroLogin" style="color:red;"></div>
</div>
<div id="sistema" style="display:none;">

  <!-- Pedidos Importados -->
  <div id="importados" class="tab-content active">
    <h2>ğŸ“¥ Importar Planilhas da Shopee</h2>
    <p><strong>Novos a Enviar:</strong><br>
      <input type="file" id="arquivoEnviar" accept=".xlsx">
    </p>
    <p><strong>Pedidos Enviados:</strong><br>
      <input type="file" id="arquivoEnviados" accept=".xlsx">
    </p>
    <p><strong>Filtrar por data:</strong><br>
      <input type="date" id="filtroData">
    </p>
    <button onclick="processarArquivos()">ğŸ“¥ Importar e Comparar</button>
<button onclick="apagarTudo()" style="background:red;color:white;font-weight:bold;">ğŸ§¨ Apagar TODOS os dados</button>
<button onclick="removerPendentesJaEnviados()">ğŸ§¹ Remover pedidos jÃ¡ enviados</button>
<button onclick="verificarEDeduplicarPedidos()" style="background:#ffc107;color:#000;font-weight:bold;">ğŸ” Verificar e Limpar Duplicados</button>

    <hr style="margin:2rem 0;">
      </div>

  <!-- PDFs de Etiquetas -->
  <div id="etiquetas_pdf" class="tab-content">
  <h2>ğŸ“‚ PDFs de Etiquetas</h2>
  <p><strong>Selecionar PDF:</strong><br>
<input type="file" id="inputPDF" accept="application/pdf">
  </p>
  <button onclick="processarPDF()">ğŸ“¦ Ler e Registrar</button>

  <ul id="listaPDFs"></ul>
</div>

  <!-- Pedidos Enviados -->
  <div id="enviados" class="tab-content">
    <h2>âœ… Pedidos Enviados</h2>
    <div style="margin:1rem 0; display:flex; gap:1rem; flex-wrap:wrap; align-items:center;">
      <label><strong>ğŸ“† MÃªs:</strong>
        <input type="month" id="filtroMesRelatorio">
      </label>
      <button onclick="exportarRelatorioMensal()">ğŸ“¤ CSV</button>
      <button onclick="exportarRelatorioPDF()">ğŸ“„ PDF</button>
    </div>
<div id="tabela-enviados"></div>
</div>
      </div>

  <!-- Novos a Enviar -->
  <div id="a_enviar" class="tab-content">
    <h2>ğŸŸ¡ Novos a Enviar</h2>
<div style="text-align:right; margin-bottom: 1rem;">
  <button onclick="alternarVisualizacaoPedidos()" id="btnVisualizacaoPedidos">
    ğŸ“¦ Visualizar como Cards
  </button>
</div>

<!-- ğŸ” Filtro de mÃºltiplas lojas -->
<div class="card-filtros">
  <label>ğŸª Filtrar por Loja:</label>
  <select id="filtroMultiloja" multiple onchange="atualizarDashboardPendentes()"></select>
 <label>ğŸ” Filtrar por Produto:</label>
  <select id="filtroMultiproduto" multiple onchange="atualizarDashboardPendentes()"></select>
<select id="filtroLoja"></select>

  <div style="flex-basis: 100%;">
    <button onclick="document.getElementById('filtroMultiloja').selectedIndex = -1;
                     document.getElementById('filtroMultiproduto').selectedIndex = -1;
                     atualizarDashboardPendentes();"
            style="background:#6c757d;color:white;padding:0.4rem 1rem;border:none;border-radius:6px;cursor:pointer;">
      ğŸ”„ Limpar Filtros
    </button>
  </div>
</div>
<hr style="border: none; height: 1px; background: #dee2e6; margin: 1.5rem 0;">
<!-- ğŸ“Š Cards de Resumo -->
<div class="cards-status">
  <div class="card-status card-novos">
    <strong>ğŸ“¦ Total a Enviar Hoje:</strong><br/>
    <span id="resumo-total-enviar">0</span>
  </div>
  <div class="card-status card-atraso">
    <strong>â° Atrasados:</strong><br/>
    <span id="resumo-atrasados">0</span>
  </div>
  <div class="card-status card-risco">
    <strong>âš ï¸ Em risco:</strong><br/>
    <span id="resumo-risco">0</span>
  </div>
  <div class="card-status card-enviados">
    <strong>âœ… Enviados Hoje:</strong><br/>
    <span id="resumo-enviados-hoje">0</span>
  </div>
</div>
 <button onclick="exportarPedidosAEnviar()" style="background:#0d6efd;color:white;margin-bottom:1rem;">
  ğŸ“¥ Exportar para Excel
</button> 
<div id="tabelaPendentes"></div>
      
  </div>

  <!-- Pedidos Cancelados -->
  <div id="cancelados" class="tab-content">
    <h2 style="display:flex; justify-content:space-between; align-items:center;">
      âŒ Cancelados
      <button onclick="exportarCanceladosCSV()" style="background:#0d6efd;color:#fff;border:none;padding:0.4rem 0.8rem;border-radius:5px;cursor:pointer;">
        â¬‡ï¸ CSV
      </button>
    </h2>
    <div style="overflow-x:auto;"><table id="tabela-cancelados">
      <thead>
        <tr>
          <th>Loja</th>
          <th>Motivo</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table></div>
  </div>
<!-- Aba: Pedidos Cancelados -->
<div id="cancelamentos-detalhados" class="tab-content">
  <h2>âŒ Pedidos Cancelados</h2>

  <!-- MÃ©tricas -->
  <div style="display:flex; gap:2rem; flex-wrap:wrap; margin-bottom:1rem;">
    <div style="background:#fff3cd; border:1px solid #ffeeba; padding:1rem; border-radius:0.5rem;">
      <strong>ğŸ“… Cancelamentos Hoje:</strong><br/>
      <span id="cancelados-hoje">0</span>
    </div>
    <div style="background:#f8d7da; border:1px solid #f5c6cb; padding:1rem; border-radius:0.5rem;">
      <strong>ğŸ“† Cancelamentos no MÃªs:</strong><br/>
      <span id="cancelados-mes">0</span>
    </div>
  </div>

  <!-- GrÃ¡fico de Cancelamentos por Dia -->
  <div style="margin-top:2rem;">
    <h3>ğŸ“ˆ Cancelamentos por Dia (mÃªs atual)</h3>
    <canvas id="graficoCanceladosDia" height="100"></canvas>
  </div>

  
</div>

<!-- Dashboard Geral -->
<div id="dashboard" class="tab-content">
  <div class="dashboard-header">
    <h2>ğŸ“Š Dashboard Geral</h2>
  </div>
<div style="text-align:right; margin-bottom: 1rem;">
  <button onclick="alternarVisualizacaoPedidos()" id="btnVisualizacaoPedidos">
    ğŸ“¦ Visualizar como Cards
  </button>
</div>

  <!-- Filtros -->
  <div class="filtros-dashboard">
    <label>
      ğŸ“… Data:
      <input type="date" id="filtroDataDashboard" onchange="atualizarDashboardPorDataLoja()" />
    </label>
    <label>
      ğŸ“Š MÃªs:
      <input type="month" id="filtroMesDashboard" onchange="atualizarDashboardPorDataLoja()" />
    </label>
    <label>
      <input type="checkbox" id="filtroMesInteiroDashboard" onchange="atualizarDashboardPorDataLoja()" />
      ğŸ”„ Considerar mÃªs inteiro
    </label>
    <label>
      ğŸª Loja:
      <select id="filtroLojaDashboard" onchange="atualizarDashboardPorDataLoja()">
        <option value="">Todas</option>
      </select>
    </label>
  </div>

  <!-- Cards de Resumo -->
  <div class="cards-status">
    <div class="card-status card-novos">
      <span>ğŸ“¦ Novos A Enviar:</span>
      <div id="valor-a-enviar-dashboard">0</div>
    </div>
    <div class="card-status card-enviados">
      <span>âœ… Enviados no mÃªs:</span>
      <div id="valor-enviados-dashboard">0</div>
    </div>
    <div class="card-status card-comatraso">
      <span>ğŸš¨ Enviados com Atraso:</span>
      <div id="valor-enviados-atraso-dashboard">0</div>
    </div>
    <div class="card-status card-atraso">
      <span>â° Atrasados:</span>
      <div id="valor-atrasados-dashboard">0</div>
    </div>
    <div class="card-status card-risco">
      <span>âš ï¸ Em risco:</span>
      <div id="valor-risco-dashboard">0</div>
    </div>
<div class="card-status card-percentual-atraso">
  <strong>ğŸ“‰ % Atrasados:</strong><br />
  <span id="percentual-atrasados">0%</span>
</div>
  </div>
<!-- Filtro por produto -->
<div style="margin-top:1rem;">
  <label for="filtroProdutoDashboard">ğŸ” Filtrar por produto:</label>
  <select id="filtroProdutoDashboard" multiple style="width:100%; max-width:400px;"></select>
</div>

  <!-- PeÃ§as Vendidas no MÃªs -->
  <div id="card-vendas-mensais" style="background:#f8f9fa; border:1px solid #dee2e6; padding:1.5rem; border-radius:0.75rem; margin-top:1.5rem;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
      <h3 style="margin:0; color:#343a40;">ğŸ“¦ PeÃ§as Vendidas no MÃªs:</h3>
      <div>
        <button onclick="exportarVendasCSV()" style="margin-right:0.5rem;">ğŸ“¥ CSV</button>
        <button onclick="exportarVendasPDF()">ğŸ“„ PDF</button>
      </div>
    </div>
    <div id="vendas-por-produto" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:1rem;"></div>
  </div>
<h3 style="margin-top:2rem;">ğŸ“ˆ Vendas por Dia no MÃªs</h3>
<div style="position:relative; height:300px;">
  <canvas id="graficoVendasPorDia"></canvas>
</div>
<div style="display:flex; align-items:center; justify-content:space-between; margin-top:2rem;">
  <h3 style="margin:0;">ğŸ† Comparativo de Vendas</h3>
  <select id="tipoComparativo" onchange="renderizarGraficoTopComparativo()" style="padding:0.25rem 0.5rem;">
    <option value="produtos">Produtos Mais Vendidos</option>
    <option value="lojas">Lojas com Mais Pedidos</option>
  </select>
</div>
<div style="position:relative; height:300px;">
  <canvas id="graficoTopProdutos"></canvas>
</div>

<!-- ğŸ“ˆ GrÃ¡fico de MÃ©dia DiÃ¡ria de Vendas -->
<div id="grafico-media-vendas" style="margin-top:2rem;">
  <h3>ğŸ“ˆ MÃ©dia DiÃ¡ria de Vendas</h3>
  <div style="margin-bottom:1rem;">
    <label><input type="radio" name="tipoMedia" value="produto" checked onchange="gerarGraficoMediaVendas()"> Por Produto</label>
    <label style="margin-left:1rem;"><input type="radio" name="tipoMedia" value="loja" onchange="gerarGraficoMediaVendas()"> Por Loja</label>
  </div>
  <div style="position:relative; height:300px;">
    <canvas id="graficoMediaPorDia"></canvas>
  </div>
</div>

<h3 style="margin-top:2rem;">â±ï¸ Tempo MÃ©dio de Envio por Loja</h3>
<div style="position:relative; height:300px;">
  <canvas id="graficoTempoEnvio"></canvas>
</div>
<h3 style="margin-top:2rem;">ğŸ“ˆ RelatÃ³rio por Loja + Produto</h3>
<div id="tabela-detalhada-vendas" style="overflow-x:auto; margin-bottom:2rem;"></div>
<button onclick="exportarRelatorioDetalhadoCSV()">ğŸ“… Exportar CSV</button>
<button onclick="exportarRelatorioDetalhadoPDF()">ğŸ“„ Exportar PDF</button>

  <!-- GrÃ¡fico de Status e Lembrete -->
  <div style="display:flex; gap:2rem; flex-wrap:wrap; justify-content:center; margin-top:2rem;">
    <div style="width:300px;">
      <canvas id="graficoStatus"></canvas>
    </div>
    <div id="lembreteUrgente" style="flex:1; min-width:300px; background:#fff3cd; border:1px solid #ffeeba; padding:1rem; border-radius:0.5rem;">
      <h3>âš ï¸ Lembrete Inteligente</h3>
      <p id="textoLembrete">Analisando pedidos...</p>
    </div>
  </div>
</div>
<div id="aba-skus-equivalentes" class="tab-content" style="padding:1rem;">
  <h2>ğŸ§© Cadastro de SKUs Equivalentes</h2>

  <form id="formSkus" onsubmit="salvarSkuEquivalente(event)">
    <label><strong>SKU Base:</strong></label><br />
    <input type="text" id="skuBase" required style="margin-bottom:0.5rem;width:200px;" /><br />
    
    <label><strong>SKUs Equivalentes (separados por vÃ­rgula):</strong></label><br />
    <input type="text" id="skusEquivalentes" placeholder="Ex: A11, A11-KIT, A11-REDONDO" required style="width:300px;" /><br />
    
    <button type="submit" style="margin-top:1rem;">â• Salvar Agrupamento</button>
  </form>

  <h3 style="margin-top:2rem;">ğŸ§¾ Agrupamentos Salvos</h3>
  <div style="overflow-x:auto;"><table border="1" cellpadding="5" id="tabelaSkus" style="border-collapse:collapse;margin-top:0.5rem;width:100%;">
    <thead>
      <tr style="background:#f0f0f0;"><th>SKU Base</th><th>Equivalentes</th><th>AÃ§Ãµes</th></tr>
    </thead>
    <tbody></tbody>
  </table></div>
</div>

<!-- ğŸ¯ Aba de Metas Manuais -->
<div id="aba-metas" class="tab-content">
  <h2>ğŸ¯ Cadastro Manual de Metas por Loja</h2>

  <form onsubmit="adicionarMetaManual(event)" style="display:flex; flex-wrap:wrap; gap:1rem; align-items:flex-end;">
    <div>
      <label>ğŸª Lojas:</label><br />
      <select id="inputLojasMeta" multiple required style="width:220px; height:90px;"></select>
    </div>
    <div>
      <label>ğŸ“¦ Produto:</label><br />
      <input type="text" id="inputProdutoMeta" required style="width:200px;" />
    </div>
    <div>
      <label>ğŸ¯ Meta Mensal:</label><br />
      <input type="number" id="inputValorMeta" required style="width:120px;" min="0" />
    </div>
    <div>
      <label>ğŸ“… MÃªs:</label><br />
      <input type="month" id="inputMesMeta" required style="width:150px;" />
    </div>
    <button type="submit" style="background:#198754; color:white; padding:0.5rem 1rem; border:none; border-radius:6px;">
      â• Adicionar Meta
    </button>
  </form>

  <hr style="margin:1.5rem 0; border: none; border-top: 1px solid #ccc;" />

  <h3>ğŸ“‹ Metas Cadastradas</h3>
  <div id="containerMetasCards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;"></div>
</div>
  
<div id="aba-produtos" class="tab-content" style="padding:1rem;">
  <h2>ğŸ“¦ Cadastro de Produtos</h2>
  <form id="formProduto" onsubmit="salvarProduto(event)" style="margin-bottom:1rem;">
    <label>Nome do Produto:</label><br />
    <input type="text" id="nomeProduto" required style="width:200px; margin-bottom:0.5rem;" /><br />
    <label>Sobra Ideal:</label><br />
    <input type="number" id="sobraIdeal" required style="width:120px;" min="0" /><br />
    <label>Valor:</label><br />
    <input type="number" id="valorProduto" required style="width:120px;" min="0" step="0.01" /><br />
    <button type="submit" style="margin-top:0.5rem;">â• Salvar</button>
  </form>
  </div>
<div id="aba-logs" class="tab-content" style="padding:2rem;">
  <h2>ğŸ•µï¸ Registro de AÃ§Ãµes</h2>
  <div id="tabelaLogs" style="margin-top:1rem;"></div>
</div>

<div id="aba-admin" class="tab-content" style="padding:1rem;">
  <h2 style="margin:2rem 0 1rem;">ğŸ“Š Acompanhamento de Metas</h2>
  <div id="container-cards-metas" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:1rem;"></div>
  <h2 style="margin:2rem 0 1rem;">ğŸ“ˆ Vendas por Loja</h2>
  <div class="filtros-dashboard">
    <label>
      ğŸ“… Data:
      <input type="date" id="filtroDataMetas" onchange="atualizarRelatorioMetas()" />
    </label>
    <label>
      <input type="checkbox" id="filtroMesInteiroMetas" onchange="atualizarRelatorioMetas()" />
      ğŸ”„ Considerar mÃªs inteiro
    </label>
    <label>
      ğŸª Loja:
      <select id="filtroLojaMetas" onchange="atualizarRelatorioMetas()">
        <option value="">Todas</option>
      </select>
    </label>
  </div>
  <div id="tabela-vendas-metas" style="margin-top:1rem;"></div>
  <h3>Produtos Salvos</h3>
  <div style="overflow-x:auto;">
    <table border="1" cellpadding="5" id="tabelaProdutos" style="border-collapse:collapse; width:100%;">
      <thead>
        <tr style="background:#f0f0f0;"><th>Produto</th><th>Sobra Ideal</th><th>Valor</th><th>AÃ§Ãµes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>



  




  




<!-- Select2 (estilo moderno para mÃºltiplos selects) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script type="module" src="main.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
</body>


</html>
